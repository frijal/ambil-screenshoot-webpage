name: Generate Screenshots (External Domain)

# ğŸ“¢ Pemicu Workflow
# Jalankan setiap hari pukul 02:00 UTC (sekitar 10 pagi WITA) dan secara manual.
on:
  workflow_dispatch:
  schedule:
    # Pelajari Cron Job: (menit jam hari-bulan bulan hari-minggu)
    # 0 2 * * * = Jam 2 pagi UTC (atau jam 10 pagi WITA) setiap hari
    - cron: '0 2 * * *' 
  
# Izinkan satu eksekusi tunggal (single concurrency)
concurrency: 
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  generate:
    # Gunakan runner Ubuntu terbaru (ini adalah pilihan terbaik untuk Puppeteer)
    runs-on: ubuntu-latest

    # Variabel Lingkungan (Opsional, jika Anda ingin menyetel BASE_URL dari secrets/env)
    env:
      NODE_VERSION: 20.x

    steps:
      - name: âš™ï¸ Checkout Kode
        uses: actions/checkout@v4

      # 1. Setup Node.js
      - name: ğŸ› ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      # 2. Instal Ketergantungan
      # Catatan: Karena menggunakan Puppeteer, kita perlu menginstal Chromium dependencies.
      - name: ğŸ“¦ Install NPM dependencies
        run: npm install

      # 3. Instal Ketergantungan Puppeteer (Chromium)
      # Ini penting agar Puppeteer dapat berjalan di runner GitHub Actions.
      - name: ğŸŒ Install system dependencies for Puppeteer
        run: |
          sudo apt-get update
          sudo apt-get install -y chromium-browser

      # 4. Jalankan Script Screenshot
      - name: ğŸ“¸ Run Screenshot Generator
        # Asumsikan script Anda berada di root directory atau dipanggil dengan benar
        run: node server-screenshot.js

      # 5. Siapkan Output
      # File gambar yang dihasilkan perlu ditambahkan ke repositori
      - name: â• Add and Commit new images
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "feat(screenshot): Add/Update webp screenshots [skip ci]"
          # Hanya commit perubahan pada folder img/
          file_pattern: 'img/*.webp'
          # Commit ke branch saat ini
          branch: ${{ github.ref_name }}
          # Mencegah trigger workflow lain yang mendengarkan 'push'
          commit_options: '--no-verify --signoff'
