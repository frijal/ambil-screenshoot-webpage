name: ğŸ“¸ Generate Screenshots (External Domain)

# ğŸ“¢ Pemicu Workflow
on:
  workflow_dispatch:
  schedule:
    - cron: '0 2 * * *' 
  
concurrency: 
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  generate:
    runs-on: ubuntu-latest

    env:
      NODE_VERSION: 20.x

    steps:
      - name: âš™ï¸ Checkout Kode
        uses: actions/checkout@v4

      # 1. Setup Node.js
      - name: ğŸ› ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      # 2. Instal Ketergantungan NPM (Termasuk Puppeteer)
      - name: ğŸ“¦ Install NPM dependencies
        run: npm install

      # 3. PASTIKAN INSTALASI CHROMIUM PUPPETEER (Solusi Cepat)
      # Menggantikan apt-get yang lambat. Perintah ini memaksa Puppeteer mengunduh 
      # versi Chromium yang kompatibel jika belum ada.
      - name: ğŸŒ Ensure Puppeteer Chromium is installed
        run: npx puppeteer install

      # 4. Jalankan Script Screenshot
      - name: ğŸ“¸ Run Screenshot Generator
        run: node ext/screenshot-puppeteer.js

      # 5. Siapkan Output
      - name: â• Add and Commit new images
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "feat(screenshot): Add/Update webp screenshots [skip ci]"
          file_pattern: 'img/*.webp'
          branch: ${{ github.ref_name }}
          commit_options: '--no-verify --signoff'
